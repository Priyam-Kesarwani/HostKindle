<%- include('../partials/head') %>
  </head>

  <body
    class="bg-base-100 text-base-content min-h-screen flex flex-col font-sans selection:bg-primary selection:text-white">
    <%- include('../partials/nav') %>

      <!-- Hero Section -->
      <header class="relative overflow-hidden py-24 px-4 text-center">
        <!-- Background Elements -->
        <div class="absolute top-0 left-0 w-full h-full overflow-hidden -z-10 opacity-20">
          <div
            class="absolute top-[-10%] left-[-10%] w-[40%] h-[40%] rounded-full bg-primary blur-[120px] animate-float">
          </div>
          <div
            class="absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] rounded-full bg-secondary blur-[120px] animate-float"
            style="animation-delay: 1.5s;"></div>
        </div>

        <div class="relative z-10 max-w-4xl mx-auto space-y-8 animate-fade-in">
          <h1 class="text-5xl md:text-7xl font-display font-extrabold leading-tight">
            <span class="text-base-content">
              Handpicked Stays
            </span><br>
            <span class="bg-clip-text text-transparent bg-gradient-to-r from-primary to-secondary">
              Unforgettable Moments
            </span>
          </h1>
          
          <div class="relative min-h-[3.5rem] flex justify-center">
            <style>
              @keyframes cursorBlink {

                0%,
                100% {
                  opacity: 1;
                }

                50% {
                  opacity: 0;
                }
              }

              .typewriter-cursor {
                animation: cursorBlink 1.2s step-end infinite;
              }

              .typing .typewriter-cursor {
                opacity: 1;
                animation: none;
              }
            </style>
            <p id="typewriter-wrapper" class="text-xl md:text-2xl text-gray-700 dark:text-gray-300 max-w-2xl mx-auto font-light">
              <span id="hero-typewriter"></span><span
                class="typewriter-cursor inline-block w-[3px] h-5 md:h-7 bg-gradient-to-b from-primary to-secondary ml-1 align-middle rounded-full mb-1 shadow-[0_0_10px_rgba(var(--p),0.5)]"></span>
            </p>
          </div>
          <script>
            (function () {
              const text = "Discover and book unique homes and immersive experiences in destinations you love.";
              const el = document.getElementById('hero-typewriter');
              const wrapper = document.getElementById('typewriter-wrapper');
              if (!el || !wrapper) return;

              let i = 0;
              wrapper.classList.add('typing');

              function type() {
                if (i < text.length) {
                  el.textContent += text.charAt(i);
                  i++;
                  // Professional typing cadence with slight variance
                  setTimeout(type, 30 + Math.random() * 40);
                } else {
                  wrapper.classList.remove('typing');
                }
              }

              // Smooth start delay
              setTimeout(type, 800);
            })();
          </script>

          <!-- Search Bar -->
          <div class="max-w-3xl mx-auto mt-12 relative group">
            <div
              class="absolute -inset-1 bg-gradient-to-r from-primary to-secondary rounded-2xl blur opacity-25 group-hover:opacity-50 transition duration-300">
            </div>
            <form action="/search" method="POST"
              class="relative bg-neutral-900/90 backdrop-blur-xl border border-white/10 rounded-2xl p-2 flex flex-col md:flex-row shadow-2xl">
              <div class="flex-1 flex items-center px-6 py-3 md:border-r border-white/5">
                <i class="fas fa-search text-gray-400 mr-4 text-lg"></i>
                <input type="text" name="search" placeholder="Search for cities, vibe, or properties..."
                  class="w-full bg-transparent text-white placeholder-gray-500 outline-none text-lg"
                  value="<%= searchQuery ? searchQuery : '' %>">
              </div>
              <button type="submit"
                class="m-1 bg-gradient-to-r from-primary to-secondary hover:from-primary/90 hover:to-secondary/90 text-white px-8 py-3 rounded-xl font-bold transition-all duration-300 shadow-lg shadow-primary/25 hover:scale-105 active:scale-95">
                Search
              </button>
            </form>
          </div>
        </div>
      </header>

      <main class="container mx-auto px-4 pb-20 flex-grow">
        <% if (isSearchResults) { %>
          <div class="text-center mb-12 animate-fade-in">
            <div class="inline-block px-4 py-1 rounded-full bg-white/5 border border-white/10 mb-4">
              <span class="text-sm text-gray-400">Search Results</span>
            </div>
            <h3 class="text-3xl font-bold text-white mb-2">
              "<%= searchQuery %>"
            </h3>
            <p class="text-gray-400">
              Found <span class="text-primary font-bold">
                <%= registeredHomes.length %>
              </span>
              <%= registeredHomes.length===1 ? 'result' : 'results' %>
            </p>
          </div>
          <% } %>

            <% if (registeredHomes.length===0 && isSearchResults) { %>
              <div class="flex flex-col items-center justify-center py-20 animate-fade-in">
                <div class="w-24 h-24 bg-white/5 rounded-full flex items-center justify-center mb-6">
                  <i class="fas fa-search text-4xl text-gray-600"></i>
                </div>
                <h3 class="text-2xl font-semibold text-white mb-2">No Results Found</h3>
                <p class="text-gray-400 mb-8 max-w-md text-center">We couldn't find any matches for your search. Try
                  broadening your keywords or browse our trending homes.</p>
                <a href="/"
                  class="px-6 py-3 rounded-xl bg-white/10 hover:bg-white/20 text-white font-medium transition-colors border border-white/5">
                  Browse All Properties
                </a>
              </div>
              <% } else { %>

                <% if (!isSearchResults) { %>
                  <div class="flex flex-col md:flex-row justify-between items-center mb-8 border-b border-white/5 pb-4">
                    <h2 class="text-2xl font-bold text-white mb-4 md:mb-0">Trending Stays</h2>

                    <div class="flex items-center space-x-4">
                      <label for="sort-select" class="text-sm text-gray-400">Sort by:</label>
                      <div class="relative">
                        <select id="sort-select"
                          class="appearance-none bg-white/5 hover:bg-white/10 border border-white/10 text-white rounded-lg pl-4 pr-10 py-2 text-sm focus:outline-none focus:border-primary transition-colors cursor-pointer">
                          <option value="price|asc" class="bg-neutral">Price: Low to High</option>
                          <option value="price|desc" class="bg-neutral">Price: High to Low</option>
                          <option value="rating|desc" class="bg-neutral">Top Rated</option>
                        </select>
                        <i
                          class="fas fa-chevron-down absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 text-xs pointer-events-none"></i>
                      </div>
                    </div>
                  </div>
                  <% } %>

                    <div id="homes-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
                      <% registeredHomes.forEach((home, index)=> { %>
                        <div
                         class="home-card group
                         bg-[#E4ECFF] text-base-content dark:bg-[#1A1A2E]
                         border border-[#C7D2FE] dark:border-white/5
                         rounded-2xl overflow-hidden
                         transition-all duration-500
                         hover:border-primary/40 hover:-translate-y-2
                         hover:shadow-2xl hover:shadow-primary/10
                         cursor-pointer flex flex-col h-full animate-slide-up"
                        
                        
                        
                          style="animation-delay: <%= index * 100 %>ms;"
                          data-price="<%= Number(String(home.price || '').replace(/[^0-9.-]/g, '')) || 0 %>"
                          data-rating="<%= Number(home.rating) || 0 %>"
                          onclick="window.location.href='/homes/<%= home._id %>'">
                          <% let photos=[]; if (home.photos && Array.isArray(home.photos) && home.photos.length> 0) {
                            photos = home.photos.filter(p => p && typeof p === 'string' && p.trim() !== '');
                            } else if (home.photo && typeof home.photo === 'string' && home.photo.trim() !== '') {
                            photos = [home.photo];
                            }
                            photos = photos.map(p => (/^https?:\/\//i.test(p) ? p : (p.startsWith('/') ? p : '/' + p)));
                            const mainPhoto = photos.length > 0 ? photos[0] : '/uploads/default.jpg';
                            %>

                            <div class="relative w-full aspect-[4/3] overflow-hidden">
                              <img src="<%= mainPhoto %>" alt="<%= home.houseName %>"
                                class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110">
                              <div
                                class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                              </div>

                              <!-- Favourite Button Wrapper -->
                              <div onclick="event.stopPropagation()" class="absolute top-3 right-3 z-20">
                                <%- include('../partials/favourite', { home: home }) %>
                              </div>

                              <div
                                class="absolute bottom-3 left-3 z-10 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center gap-2">
                                <% if (photos.length> 1) { %>
                                  <span
                                    class="bg-black/50 backdrop-blur-md text-white/90 text-xs px-2 py-1 rounded-full border border-white/10">
                                    <i class="fas fa-images mr-1"></i>
                                    <%= photos.length %>
                                  </span>
                                  <% } %>
                              </div>
                            </div>

                            <div class="p-5 flex flex-col flex-grow bg-[#E4ECFF] dark:bg-[#1A1A2E]">
                              <div class="flex justify-between items-start mb-2">
                                <h3
                                  class="text-lg font-bold text-base-content leading-tight group-hover:text-primary transition-colors">
                                  <%= home.houseName %>
                                </h3>
                                <div class="flex items-center bg-base-200 dark:bg-white/5 px-2 py-1 rounded-lg border border-base-200 dark:border-white/5">
                                  <i class="fas fa-star text-yellow-500 text-xs mr-1"></i>
                                  <span class="text-xs font-bold text-base-content">
                                    <%= (home.rating || 0).toFixed(1) %>
                                  </span>
                                </div>
                              </div>

                              <div class="flex items-center text-gray-600 dark:text-gray-400 mb-3 text-sm">
                                <i class="fas fa-map-marker-alt mr-2 text-primary/70"></i>
                                <span class="truncate">
                                  <%= home.location %>
                                </span>
                              </div>

                              <p class="text-gray-700 dark:text-gray-500 text-sm line-clamp-2 mb-4 flex-grow">
                                <%= home.description %>
                              </p>

                              <div class="border-t border-base-200 dark:border-white/5 pt-4 mt-auto flex justify-between items-center">
                                <div>
                                  <span class="text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wider">Price</span>
                                  <div class="text-lg font-bold text-base-content">
                                    Rs <%= home.price %> <span class="text-sm text-gray-600 dark:text-gray-500 font-normal">/ month</span>
                                  </div>
                                </div>

                                <% if (isLoggedIn) { %>
                                  <button
                                    class="bg-base-200 hover:bg-primary hover:text-white text-gray-700 dark:text-gray-300 p-2 rounded-lg transition-all duration-300 border border-base-200 dark:border-white/10 group-hover:border-primary/50">
                                    <i class="fas fa-arrow-right"></i>
                                  </button>
                                  <% } else { %>
                                    <div class="text-xs text-gray-500 italic">Login to book</div>
                                    <% } %>
                              </div>
                            </div>
                        </div>
                        <% }) %>
                    </div>
                    <% } %>

                      <script>
                        (function () {
                          const select = document.getElementById('sort-select');
                          const container = document.getElementById('homes-grid');
                          if (!select || !container) return;

                          function sortHomes(val) {
                            const [field, order] = val.split('|');
                            const cards = Array.from(container.querySelectorAll('.home-card'));
                            cards.sort((a, b) => {
                              const av = parseFloat(a.dataset[field]) || 0;
                              const bv = parseFloat(b.dataset[field]) || 0;
                              return order === 'asc' ? av - bv : bv - av;
                            });
                            cards.forEach(c => container.appendChild(c));
                          }

                          select.addEventListener('change', function () {
                            sortHomes(this.value);
                          });

                          if (select.value) {
                            sortHomes(select.value);
                          }
                        })();
                      </script>
      </main>
  </body>

  </html>